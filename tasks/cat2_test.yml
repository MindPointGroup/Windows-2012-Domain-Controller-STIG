- name: "MEDIUM | V-1141 | AUDIT | Unencrypted passwords must not be sent to third-party SMB Servers."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters /v EnablePlainTextPassword
  register: plain_text_password_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in plain_text_password_audit.stderr and plain_text_password_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1141

- name: "MEDIUM | V-1141 | PATCH | Unencrypted passwords must not be sent to third-party SMB Servers."
  win_regedit: 
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters'
      value: EnablePlainTextPassword
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1141

- name: "MEDIUM | V-1145 | AUDIT | Automatic logons must be disabled."
  win_command: reg query \"HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v AutoAdminLogon /t REG_SZ /f 0
  register: disable_automatic_logons_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_automatic_logons_audit.stderr and disable_automatic_logons_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1145

- name: "MEDIUM | V-1145 | PATCH | Automatic logons must be disabled."
  win_regedit: 
    key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
    value: AutoAdminLogon
    data: 0
  tags:
      - cat2
      - medium
      - patch
      - V-1145

- name: "MEDIUM | V-1154 | AUDIT | The Ctrl+Alt+Del security attention sequence for logons will be enabled."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v DisableCAD
  register: disable_CAD_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_CAD_audit.stderr and disable_CAD_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1154

- name: "MEDIUM | V-1154 | PATCH | The Ctrl+Alt+Del security attention sequence for logons will be enabled."
  win_regedit: 
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System'
      value: DisableCAD
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1154

- name: "MEDIUM | V-1162 | AUDIT | The Windows SMB server will perform SMB packet signing when possible."
  win_command: reg query HKLM\System\CurrentControlSet\Services\LanManServer\Parameters /v EnableSecuritySignature
  register: SMB_server_packet_signing_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in SMB_server_packet_signing_audit.stderr and SMB_server_packet_signing_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1162

- name: "MEDIUM | V-1162 | PATCH | The Windows SMB server will perform SMB packet signing when possible."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Services\LanManServer\Parameters'
      value: EnableSecuritySignature
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1162

- name: "MEDIUM | V-1163 | AUDIT | Outgoing secure channel traffic will be encrypted when possible."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v SealSecureChannel
  register: encrypt_outgoing_secure_channel_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in encrypt_outgoing_secure_channel_audit.stderr and encrypt_outgoing_secure_channel_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1163

- name: "MEDIUM | V-1163 | PATCH | Outgoing secure channel traffic will be encrypted when possible."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: SealSecureChannel
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1163

- name: "MEDIUM | V-1164 | AUDIT | Outgoing secure channel traffic will be signed when possible."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v SignSecureChannel
  register: sign_outgoing_secure_channel_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in sign_outgoing_secure_channel_audit.stderr and sign_outgoing_secure_channel_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1164

- name: "MEDIUM | V-1164 | PATCH | Outgoing secure channel traffic will be signed when possible."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: SignSecureChannel
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1164

- name: "MEDIUM | V-1166 | AUDIT | The Windows SMB client will be enabled to perform SMB packet signing when possible."
  win_command: reg query HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters /v EnableSecuritySignature
  register: SMB_client_packet_signing_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in SMB_client_packet_signing_audit.stderr and SMB_client_packet_signing_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1166

- name: "MEDIUM | V-1166 | PATCH | The Windows SMB client will be enabled to perform SMB packet signing when possible."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Services\LanmanWorkstation\Parameters'
      value: EnableSecuritySignature
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-1166

- name: "MEDIUM | V-1171 | AUDIT | Ejection of removable NTFS media is not restricted to Administrators."
  win_command: reg query \"HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v AllocateDASD
  register: eject_removable_media_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in eject_removable_media_audit.stderr and eject_removable_media_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-1171

- name: "MEDIUM | V-1171 | PATCH | Ejection of removable NTFS media is not restricted to Administrators."
  win_regedit: 
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: AllocateDASD
      data: 0
  tags:
      - cat2
      - medium
      - patch
      - V-1171

- name: "MEDIUM | V-3374 | AUDIT | The system must be configured to require a strong session key."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters\ /v RequireStrongKey /t REG_DWORD /f 1
  register: strong_sessionkey_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in strong_sessionkey_audit.stderr and strong_sessionkey_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3374

- name: "MEDIUM | V-3374 | PATCH | The system must be configured to require a strong session key."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters\'
      value: RequireStrongKey
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3374

- name: "MEDIUM | V-3376 | AUDIT | The system will be configured to prevent the storage of passwords and credentials"
  win_command: reg query HKLM\System\CurrentControlSet\Control\Lsa /v DisableDomainCreds
  register: creds_storage_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in creds_storage_audit.stderr and creds_storage_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3376

- name: "MEDIUM | V-3376 | PATCH | The system will be configured to prevent the storage of passwords and credentials"
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Control\Lsa'
      value: DisableDomainCreds
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3376

- name: "MEDIUM | V-3377 | AUDIT | The system will be configured to prevent anonymous users from having the same rights as the Everyone group."
  win_command: reg query HKLM\System\CurrentControlSet\Control\Lsa /v EveryoneIncludesAnonymous
  register: everyone_includes_anon_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in everyone_includes_anon_audit.stderr and everyone_includes_anon_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3377

- name: "MEDIUM | V-3377 | PATCH | The system will be configured to prevent anonymous users from having the same rights as the Everyone group."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Control\Lsa'
      value: EveryoneIncludesAnonymous
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3377

- name: "MEDIUM | V-3378 | AUDIT | The system will be configured to use the Classic security model."
  win_command: reg query HKLM\System\CurrentControlSet\Control\Lsa /v ForceGuest
  register: classic_security_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in classic_security_audit.stderr and classic_security_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3378

- name: "MEDIUM | V-3378 | PATCH | The system will be configured to use the Classic security model."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Control\Lsa'
      value: ForceGuest
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3378

- name: "MEDIUM | V-3381 | AUDIT | The system will be configured to the required LDAP client signing level."
  win_command: reg query HKLM\System\CurrentControlSet\Services\LDAP /v LDAPClientIntegrity
  register: LDAP_client_integrity_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in LDAP_client_integrity_audit.stderr and LDAP_client_integrity_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3381

- name: "MEDIUM | V-3381 | PATCH | The system will be configured to the required LDAP client signing level."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Services\LDAP'
      value: LDAPClientIntegrity
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3381

- name: "MEDIUM | V-3382 | AUDIT | The system will be configured to meet the minimum session security requirement for NTLM SSP based clients."
  win_command: reg query HKLM\System\CurrentControlSet\Control\Lsa\MSV1_0 /v NTLMMinClientSec
  register: NTLM_min_client_sec_audit
  check_mode: no
  changed_when: "'0x20080000' not in NTLM_min_client_sec_audit.stdout"
  failed_when: "reg_not_found not in NTLM_min_client_sec_audit.stderr and NTLM_min_client_sec_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3382

#Patch omitted for SCIF
#- name: "MEDIUM | V-3382 | PATCH | The system will be configured to meet the minimum session security requirement for NTLM SSP based clients."
#  win_regedit:
#      key: 'HKLM:\System\CurrentControlSet\Control\Lsa\MSV1_0'
#      value: NTLMMinClientSec
#      data: 537395200
#      datatype: dword
#  tags:
#      - cat2
#      - medium
#      - patch
#      - V-3382

- name: "MEDIUM | V-3385 | AUDIT | The system must be configured to require case insensitivity for non-Windows subsystems."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Session Manager\Kernel\" /v ObCaseInsensitive
  register: case_insensitive_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in case_insensitive_audit.stderr and case_insensitive_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3385

- name: "MEDIUM | V-3385 | PATCH | The system must be configured to require case insensitivity for non-Windows subsystems."
  win_regedit: 
      key: 'HKLM:\System\CurrentControlSet\Control\Session Manager\Kernel'
      value: ObCaseInsensitive
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3385

- name: "MEDIUM | V-3449 | AUDIT | Remote Desktop Services will limit users to one remote session."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v fSingleSessionPerUser
  register: single_rdp_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in single_rdp_audit.stderr and single_rdp_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3449

- name: "MEDIUM | V-3449 | PATCH | Remote Desktop Services will limit users to one remote session."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: fSingleSessionPerUser
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3449

- name: "MEDIUM | V-3453 | AUDIT | Remote Desktop Services will always prompt a client for passwords upon connection."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v fPromptForPassword
  register: rdp_password_prompt_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in rdp_password_prompt_audit.stderr and rdp_password_prompt_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3453

- name: "MEDIUM | V-3453 | PATCH | Remote Desktop Services will always prompt a client for passwords upon connection."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: fPromptForPassword
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3453

- name: "MEDIUM | V-3454 | AUDIT | Remote Desktop Services will be configured with the client connection encryption set to the required level."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v MinEncryptionLevel
  register: min_encrypt_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in min_encrypt_audit.stderr and min_encrypt_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3454

#Patch omitted for SCIF
#- name: "MEDIUM | V-3454 | PATCH | Remote Desktop Services will be configured with the client connection encryption set to the required level."
#  action: win_ping
#  tags:
#      - cat2
#      - medium
#      - patch
#      - V-3454

- name: "MEDIUM | V-3455 | AUDIT | Remote Desktop Services will be configured to use session-specific temporary folders."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v PerSessionTempDir
  register: temp_folder_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in temp_folder_audit.stderr and temp_folder_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3455

- name: "MEDIUM | V-3455 | PATCH | Remote Desktop Services will be configured to use session-specific temporary folders."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: PerSessionTempDir
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3455

- name: "MEDIUM | V-3456 | AUDIT | Remote Desktop Services will delete temporary folders when a session is terminated."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v DeleteTempDirsOnExit
  register: delete_temp_folder_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in delete_temp_folder_audit.stderr and delete_temp_folder_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3456

- name: "MEDIUM | V-3456 | PATCH | Remote Desktop Services will delete temporary folders when a session is terminated."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: DeleteTempDirsOnExit
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3456

- name: "MEDIUM | V-3457 | AUDIT | Remote Desktop Services will be configured to set a time limit for disconnected sessions."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v MaxDisconnectionTime
  register: max_disconnection_time_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in max_disconnection_time_audit.stderr and max_disconnection_time_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3457

- name: "MEDIUM | V-3457 | PATCH | Remote Desktop Services will be configured to set a time limit for disconnected sessions."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: MaxDisconnectionTime
      data: 0x0000ea60
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3457

- name: "MEDIUM | V-3458 | AUDIT | Remote Desktop Services will be configured to disconnect an idle session after the specified time period."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services\" /v MaxIdleTime
  register: max_idle_time_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in max_idle_time_audit.stderr and max_idle_time_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3458

- name: "MEDIUM | V-3458 | PATCH | Remote Desktop Services will be configured to disconnect an idle session after the specified time period."
  win_regedit: 
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: MaxIdleTime
      data: 0x000dbba0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3458

- name: "MEDIUM | V-3469 | AUDIT | The system will be configured to enable the background refresh of Group Policy."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\system /v DisableBkGndGroupPolicy
  register: background_group_policy_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in background_group_policy_audit.stderr and background_group_policy_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-3469

- name: "MEDIUM | V-3469 | PATCH | The system will be configured to enable the background refresh of Group Policy."
  win_regedit: 
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\system'
      value: DisableBkGndGroupPolicy
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-3469

- name: "MEDIUM | V-26575 | AUDIT | The 6to4 IPv6 transition technology will be disabled."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\TCPIP\v6Transition /v 6to4_State
  register: six_to_four_audit
  check_mode: no
  changed_when: no
  failed_when: "six_to_four_audit.stderr and reg_not_found not in six_to_four_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26575

- name: "MEDIUM | V-26575 | PATCH | The 6to4 IPv6 transition technology will be disabled."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\TCPIP\v6Transition'
      value: 6to4_State
      data: Disabled
  tags:
      - cat2
      - medium
      - patch
      - V-26575

- name: "MEDIUM | V-26576 | AUDIT | The IP-HTTPS IPv6 transition technology will be disabled."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\TCPIP\v6Transition\IPHTTPS\IPHTTPSInterface /v IPHTTPS_ClientState
  register: IPv6_transition_audit
  check_mode: no
  changed_when: no
  failed_when: "IPv6_transition_audit.stderr and reg_not_found not in IPv6_transition_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26576

- name: "MEDIUM | V-26576 | PATCH | The IP-HTTPS IPv6 transition technology will be disabled."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\TCPIP\v6Transition\IPHTTPS\IPHTTPSInterface'
      value: IPHTTPS_ClientState
      data: 3
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-26576

- name: "MEDIUM | V-26577 | AUDIT | The ISATAP IPv6 transition technology will be disabled."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\TCPIP\v6Transition /v ISATAP_State
  register: ISATAP_audit
  check_mode: no
  changed_when: no
  failed_when: "ISATAP_audit.stderr and reg_not_found not in ISATAP_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26577

- name: "MEDIUM | V-26577 | PATCH | The ISATAP IPv6 transition technology will be disabled."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\TCPIP\v6Transition'
      value: ISATAP_State
      data: Disabled
  tags:
      - cat2
      - medium
      - patch
      - V-26577

- name: "MEDIUM | V-26578 | AUDIT | The Teredo IPv6 transition technology will be disabled."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\TCPIP\v6Transition /v Teredo_State
  register: Teredo_audit
  check_mode: no
  changed_when: no
  failed_when: "Teredo_audit.stderr and reg_not_found not in Teredo_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26578

- name: "MEDIUM | V-26578 | PATCH | The Teredo IPv6 transition technology will be disabled."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\TCPIP\v6Transition'
      value: Teredo_State
      data: Disabled
  tags:
      - cat2
      - medium
      - patch
      - V-26578

- name: "MEDIUM | V-26579 | AUDIT | The Application event log must be configured to a minimum size requirement."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application /v MaxSize
  register: application_log_max_size_audit
  check_mode: no
  changed_when: no
  failed_when: "application_log_max_size_audit.stderr and reg_not_found not in application_log_max_size_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26579

- name: "MEDIUM | V-26579 | PATCH | The Application event log must be configured to a minimum size requirement."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application'
      value: MaxSize
      data: 0x00008000
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-26579

- name: "MEDIUM | V-26580 | AUDIT | The Security event log must be configured to a minimum size requirement."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\Security /v MaxSize
  register: security_log_max_size_audit
  check_mode: no
  changed_when: no
  failed_when: "security_log_max_size_audit.stderr and reg_not_found not in security_log_max_size_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26580

- name: "MEDIUM | V-26580 | PATCH | The Security event log must be configured to a minimum size requirement."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Security'
      value: MaxSize
      data: 0x00030000
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-26580

- name: "MEDIUM | V-26581 | AUDIT | The Setup event log must be configured to a minimum size requirement."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\Setup /v MaxSize
  register: setup_log_max_size_audit
  check_mode: no
  changed_when: no
  failed_when: "setup_log_max_size_audit.stderr and reg_not_found not in setup_log_max_size_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26581

- name: "MEDIUM | V-26581 | PATCH | The Setup event log must be configured to a minimum size requirement."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Setup'
      value: MaxSize
      data: 0x00008000
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-26581

- name: "MEDIUM | V-26582 | AUDIT | The System event log must be configured to a minimum size requirement."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\System /v MaxSize
  register: system_log_max_size_audit
  check_mode: no
  changed_when: no
  failed_when: "system_log_max_size_audit.stderr and reg_not_found not in system_log_max_size_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-26582

- name: "MEDIUM | V-26582 | PATCH | The System event log must be configured to a minimum size requirement."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\System'
      value: MaxSize
      data: 0x00008000
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-26582

- name: "MEDIUM | V-36679 | AUDIT | Early Launch Antimalware, Boot-Start Driver Initialization Policy must be enabled and configured to only Good and Unknown."
  win_command: reg query HKLM\System\CurrentControlSet\Policies\EarlyLaunch\ /v DriverLoadPolicy /f REG_DWORD /t 1
  register: early_initialization_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in early_initialization_audit.stderr and early_initialization_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36679

- name: "MEDIUM | V-36679 | PATCH | Early Launch Antimalware, Boot-Start Driver Initialization Policy must be enabled and configured to only Good and Unknown."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Policies\EarlyLaunch\'
      value: DriverLoadPolicy
      data: 1
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36679

- name: "MEDIUM | V-36680 | AUDIT | Access to the Windows Store must be turned off."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer\ /v NoUseStoreOpenWith /t REG_DWORD /f 1
  register: windows_store_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in windows_store_audit.stderr and windows_store_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36680

- name: "MEDIUM | V-36680 | PATCH | Access to the Windows Store must be turned off."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Explorer\'
      value: NoUseStoreOpenWith
      data: 1
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36680

- name: "MEDIUM | V-36681 | AUDIT | Copying of user input methods to the system account for sign-in must be prevented."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Control Panel\International\" /v BlockUserInputMethodsForSignIn /t REG_DWORD /f 1
  register: copy_user_system_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in copy_user_system_audit.stderr and copy_user_system_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36681

- name: "MEDIUM | V-36681 | PATCH | Copying of user input methods to the system account for sign-in must be prevented."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Control Panel\International\'
      value: BlockUserInputMethodsForSignIn
      data: 1
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36681

- name: "MEDIUM | V-36684 | AUDIT | Local users on domain-joined computers must not be enumerated."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\System\ /v EnumerateLocalUsers /t REG_DWORD /f 0
  register: local_domain_joined_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in local_domain_joined_audit.stderr and local_domain_joined_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36684

- name: "MEDIUM | V-36684 | PATCH | Local users on domain-joined computers must not be enumerated."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\System\'
      value: EnumerateLocalUsers
      data: 0
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36684

- name: "MEDIUM | V-36687 | AUDIT | App notifications on the lock screen must be turned off."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\System\ /v DisableLockScreenAppNotifications /t REG_DWORD /f 1
  register: app_notifications_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in app_notifications_audit.stderr and app_notifications_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36687

- name: "MEDIUM | V-36687 | PATCH | App notifications on the lock screen must be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\System\'
      value: DisableLockScreenAppNotifications
      data: 1
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36687

- name: "MEDIUM | V-36698 | AUDIT | The use of biometrics must be disabled."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\Biometrics\ /v Enabled
  register: biometrics_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in biometrics_audit.stderr and biometrics_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36698

- name: "MEDIUM | V-36698 | PATCH | The use of biometrics must be disabled."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Biometrics\'
      value: Enabled
      data: 0
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36698

- name: "MEDIUM | V-36700 | AUDIT | The password reveal button must not be displayed."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\CredUI\ /v DisablePasswordReveal
  register: password_reveal_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in password_reveal_audit.stderr and password_reveal_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36700

- name: "MEDIUM | V-36700 | PATCH | The password reveal button must not be displayed."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\CredUI\'
      value: DisablePasswordReveal
      data: 1
      datatype: dword
  changed_when: no
  tags:
      - cat2
      - medium
      - patch
      - V-36700

- name: "MEDIUM | V-36708 | AUDIT | The location feature must be turned off."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\LocationAndSensors\ /v DisableLocation
  register: location_feature_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in location_feature_audit.stderr and location_feature_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36708

- name: "MEDIUM | V-36708 | PATCH | The location feature must be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\LocationAndSensors\'
      value: DisableLocation
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36708

- name: "MEDIUM | V-36709 | AUDIT | Basic authentication for RSS feeds over HTTP must be turned off."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Internet Explorer\Feeds\" /v AllowBasicAuthInClear
  register: authentication_rss_http_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in authentication_rss_http_audit.stderr and authentication_rss_http_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36709

- name: "MEDIUM | V-36709 | PATCH | Basic authentication for RSS feeds over HTTP must be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Internet Explorer\Feeds\'
      value: AllowBasicAuthInClear
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36709

- name: "MEDIUM | V-36711 | AUDIT | The Windows Store application must be turned off."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\WindowsStore\ /v RemoveWindowsStore
  register: windows_store_app_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in windows_store_app_audit.stderr and windows_store_app_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36711

- name: "MEDIUM | V-36711 | PATCH | The Windows Store application must be turned off."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsStore\'
      value: RemoveWindowsStore
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36711

- name: "MEDIUM | V-36713 | AUDIT | The Windows Remote Management (WinRM) client must not allow unencrypted traffic."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\WinRM\Client\ /v AllowUnencryptedTraffic
  register: winrm_unencrypted_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in winrm_unencrypted_audit.stderr and winrm_unencrypted_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36713

- name: "MEDIUM | V-36713 | PATCH | The Windows Remote Management (WinRM) client must not allow unencrypted traffic."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\WinRM\Client\'
      value: AllowUnencryptedTraffic
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36713

- name: "MEDIUM | V-36714 | AUDIT | The Windows Remote Management (WinRM) client must not use Digest authentication."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\WinRM\Client\ /v AllowDigest
  register: winrm_digest_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in winrm_digest_audit.stderr and winrm_digest_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36714

- name: "MEDIUM | V-36714 | PATCH | The Windows Remote Management (WinRM) client must not use Digest authentication."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\WinRM\Client\'
      value: AllowDigest
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36714

- name: "MEDIUM | V-36719 | AUDIT | The Windows Remote Management (WinRM) service must not allow unencrypted traffic."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\WinRM\Service\ /v AllowUnencryptedTraffic
  register: winrm_unencrypted_traffic_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in winrm_unencrypted_traffic_audit.stderr and winrm_unencrypted_traffic_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36719

- name: "MEDIUM | V-36719 | PATCH | The Windows Remote Management (WinRM) service must not allow unencrypted traffic."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\WinRM\Service\'
      value: AllowUnencryptedTraffic
      data: 0
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36719

- name: "MEDIUM | V-36720 | AUDIT | The Windows Remote Management (WinRM) service must not store RunAs credentials."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\WinRM\Service\ /v DisableRunAs
  register: winrm_store_runas_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in winrm_store_runas_audit.stderr and winrm_store_runas_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36720

- name: "MEDIUM | V-36720 | PATCH | The Windows Remote Management (WinRM) service must not store RunAs credentials."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\WinRM\Service\'
      value: DisableRunAs
      data: 1
      datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36720

- name: "MEDIUM | V-36773 | AUDIT | The machine inactivity limit must be set to 15 minutes, locking the system with the screensaver."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v InactivityTimeoutSecs
  register: inactivity_limit_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in inactivity_limit_audit.stderr and inactivity_limit_audit.stderr"
  tags:
      - cat2
      - medium
      - audit
      - V-36773

- name: "MEDIUM | V-36773 | PATCH | The machine inactivity limit must be set to 15 minutes, locking the system with the screensaver."
  win_regedit:
     key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System\'
     value: InactivityTimeout
     data: 0x00000384
     datatype: dword
  tags:
      - cat2
      - medium
      - patch
      - V-36773
